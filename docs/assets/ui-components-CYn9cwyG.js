import{K as Be,S as He,H as qe,C as Ve,R as Je,T as Ke,P as he}from"./synthesis-core-jTVWHW8U.js";function We(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var je={exports:{}},J={},Ne={exports:{}},d={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $=Symbol.for("react.element"),Ye=Symbol.for("react.portal"),Xe=Symbol.for("react.fragment"),Qe=Symbol.for("react.strict_mode"),Ze=Symbol.for("react.profiler"),et=Symbol.for("react.provider"),tt=Symbol.for("react.context"),nt=Symbol.for("react.forward_ref"),rt=Symbol.for("react.suspense"),st=Symbol.for("react.memo"),ot=Symbol.for("react.lazy"),ye=Symbol.iterator;function at(e){return e===null||typeof e!="object"?null:(e=ye&&e[ye]||e["@@iterator"],typeof e=="function"?e:null)}var Ce={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Ee=Object.assign,Re={};function R(e,t,n){this.props=e,this.context=t,this.refs=Re,this.updater=n||Ce}R.prototype.isReactComponent={};R.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};R.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function De(){}De.prototype=R.prototype;function le(e,t,n){this.props=e,this.context=t,this.refs=Re,this.updater=n||Ce}var ue=le.prototype=new De;ue.constructor=le;Ee(ue,R.prototype);ue.isPureReactComponent=!0;var be=Array.isArray,Oe=Object.prototype.hasOwnProperty,de={current:null},ze={key:!0,ref:!0,__self:!0,__source:!0};function Me(e,t,n){var r,s={},o=null,a=null;if(t!=null)for(r in t.ref!==void 0&&(a=t.ref),t.key!==void 0&&(o=""+t.key),t)Oe.call(t,r)&&!ze.hasOwnProperty(r)&&(s[r]=t[r]);var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];s.children=c}if(e&&e.defaultProps)for(r in l=e.defaultProps,l)s[r]===void 0&&(s[r]=l[r]);return{$$typeof:$,type:e,key:o,ref:a,props:s,_owner:de.current}}function it(e,t){return{$$typeof:$,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function fe(e){return typeof e=="object"&&e!==null&&e.$$typeof===$}function ct(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var ve=/\/+/g;function Z(e,t){return typeof e=="object"&&e!==null&&e.key!=null?ct(""+e.key):t.toString(36)}function G(e,t,n,r,s){var o=typeof e;(o==="undefined"||o==="boolean")&&(e=null);var a=!1;if(e===null)a=!0;else switch(o){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case $:case Ye:a=!0}}if(a)return a=e,s=s(a),e=r===""?"."+Z(a,0):r,be(s)?(n="",e!=null&&(n=e.replace(ve,"$&/")+"/"),G(s,t,n,"",function(u){return u})):s!=null&&(fe(s)&&(s=it(s,n+(!s.key||a&&a.key===s.key?"":(""+s.key).replace(ve,"$&/")+"/")+e)),t.push(s)),1;if(a=0,r=r===""?".":r+":",be(e))for(var l=0;l<e.length;l++){o=e[l];var c=r+Z(o,l);a+=G(o,t,n,c,s)}else if(c=at(e),typeof c=="function")for(e=c.call(e),l=0;!(o=e.next()).done;)o=o.value,c=r+Z(o,l++),a+=G(o,t,n,c,s);else if(o==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return a}function U(e,t,n){if(e==null)return e;var r=[],s=0;return G(e,r,"","",function(o){return t.call(n,o,s++)}),r}function lt(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var p={current:null},B={transition:null},ut={ReactCurrentDispatcher:p,ReactCurrentBatchConfig:B,ReactCurrentOwner:de};function Te(){throw Error("act(...) is not supported in production builds of React.")}d.Children={map:U,forEach:function(e,t,n){U(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return U(e,function(){t++}),t},toArray:function(e){return U(e,function(t){return t})||[]},only:function(e){if(!fe(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};d.Component=R;d.Fragment=Xe;d.Profiler=Ze;d.PureComponent=le;d.StrictMode=Qe;d.Suspense=rt;d.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ut;d.act=Te;d.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=Ee({},e.props),s=e.key,o=e.ref,a=e._owner;if(t!=null){if(t.ref!==void 0&&(o=t.ref,a=de.current),t.key!==void 0&&(s=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)Oe.call(t,c)&&!ze.hasOwnProperty(c)&&(r[c]=t[c]===void 0&&l!==void 0?l[c]:t[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];r.children=l}return{$$typeof:$,type:e.type,key:s,ref:o,props:r,_owner:a}};d.createContext=function(e){return e={$$typeof:tt,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:et,_context:e},e.Consumer=e};d.createElement=Me;d.createFactory=function(e){var t=Me.bind(null,e);return t.type=e,t};d.createRef=function(){return{current:null}};d.forwardRef=function(e){return{$$typeof:nt,render:e}};d.isValidElement=fe;d.lazy=function(e){return{$$typeof:ot,_payload:{_status:-1,_result:e},_init:lt}};d.memo=function(e,t){return{$$typeof:st,type:e,compare:t===void 0?null:t}};d.startTransition=function(e){var t=B.transition;B.transition={};try{e()}finally{B.transition=t}};d.unstable_act=Te;d.useCallback=function(e,t){return p.current.useCallback(e,t)};d.useContext=function(e){return p.current.useContext(e)};d.useDebugValue=function(){};d.useDeferredValue=function(e){return p.current.useDeferredValue(e)};d.useEffect=function(e,t){return p.current.useEffect(e,t)};d.useId=function(){return p.current.useId()};d.useImperativeHandle=function(e,t,n){return p.current.useImperativeHandle(e,t,n)};d.useInsertionEffect=function(e,t){return p.current.useInsertionEffect(e,t)};d.useLayoutEffect=function(e,t){return p.current.useLayoutEffect(e,t)};d.useMemo=function(e,t){return p.current.useMemo(e,t)};d.useReducer=function(e,t,n){return p.current.useReducer(e,t,n)};d.useRef=function(e){return p.current.useRef(e)};d.useState=function(e){return p.current.useState(e)};d.useSyncExternalStore=function(e,t,n){return p.current.useSyncExternalStore(e,t,n)};d.useTransition=function(){return p.current.useTransition()};d.version="18.3.1";Ne.exports=d;var b=Ne.exports;const z=We(b);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dt=b,ft=Symbol.for("react.element"),mt=Symbol.for("react.fragment"),pt=Object.prototype.hasOwnProperty,ht=dt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,yt={key:!0,ref:!0,__self:!0,__source:!0};function $e(e,t,n){var r,s={},o=null,a=null;n!==void 0&&(o=""+n),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(a=t.ref);for(r in t)pt.call(t,r)&&!yt.hasOwnProperty(r)&&(s[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)s[r]===void 0&&(s[r]=t[r]);return{$$typeof:ft,type:e,key:o,ref:a,props:s,_owner:ht.current}}J.Fragment=mt;J.jsx=$e;J.jsxs=$e;je.exports=J;var i=je.exports;const _e=e=>{let t;const n=new Set,r=(u,f)=>{const m=typeof u=="function"?u(t):u;if(!Object.is(m,t)){const w=t;t=f??(typeof m!="object"||m===null)?m:Object.assign({},t,m),n.forEach(P=>P(t,w))}},s=()=>t,l={setState:r,getState:s,getInitialState:()=>c,subscribe:u=>(n.add(u),()=>n.delete(u))},c=t=e(r,s,l);return l},bt=e=>e?_e(e):_e,vt=e=>e;function _t(e,t=vt){const n=z.useSyncExternalStore(e.subscribe,z.useCallback(()=>t(e.getState()),[e,t]),z.useCallback(()=>t(e.getInitialState()),[e,t]));return z.useDebugValue(n),n}const xt=e=>{const t=bt(e),n=r=>_t(t,r);return Object.assign(n,t),n},gt=e=>xt;var Fe=Symbol.for("immer-nothing"),xe=Symbol.for("immer-draftable"),h=Symbol.for("immer-state");function _(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var N=Object.getPrototypeOf;function C(e){return!!e&&!!e[h]}function k(e){return e?Ae(e)||Array.isArray(e)||!!e[xe]||!!e.constructor?.[xe]||F(e)||W(e):!1}var wt=Object.prototype.constructor.toString();function Ae(e){if(!e||typeof e!="object")return!1;const t=N(e);if(t===null)return!0;const n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return n===Object?!0:typeof n=="function"&&Function.toString.call(n)===wt}function H(e,t){K(e)===0?Reflect.ownKeys(e).forEach(n=>{t(n,e[n],e)}):e.forEach((n,r)=>t(r,n,e))}function K(e){const t=e[h];return t?t.type_:Array.isArray(e)?1:F(e)?2:W(e)?3:0}function re(e,t){return K(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function Le(e,t,n){const r=K(e);r===2?e.set(t,n):r===3?e.add(n):e[t]=n}function Pt(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}function F(e){return e instanceof Map}function W(e){return e instanceof Set}function S(e){return e.copy_||e.base_}function se(e,t){if(F(e))return new Map(e);if(W(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const n=Ae(e);if(t===!0||t==="class_only"&&!n){const r=Object.getOwnPropertyDescriptors(e);delete r[h];let s=Reflect.ownKeys(r);for(let o=0;o<s.length;o++){const a=s[o],l=r[a];l.writable===!1&&(l.writable=!0,l.configurable=!0),(l.get||l.set)&&(r[a]={configurable:!0,writable:!0,enumerable:l.enumerable,value:e[a]})}return Object.create(N(e),r)}else{const r=N(e);if(r!==null&&n)return{...e};const s=Object.create(r);return Object.assign(s,e)}}function me(e,t=!1){return Y(e)||C(e)||!k(e)||(K(e)>1&&Object.defineProperties(e,{set:{value:I},add:{value:I},clear:{value:I},delete:{value:I}}),Object.freeze(e),t&&Object.values(e).forEach(n=>me(n,!0))),e}function I(){_(2)}function Y(e){return Object.isFrozen(e)}var St={};function j(e){const t=St[e];return t||_(0,e),t}var M;function Ue(){return M}function kt(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function ge(e,t){t&&(j("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function oe(e){ae(e),e.drafts_.forEach(jt),e.drafts_=null}function ae(e){e===M&&(M=e.parent_)}function we(e){return M=kt(M,e)}function jt(e){const t=e[h];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function Pe(e,t){t.unfinalizedDrafts_=t.drafts_.length;const n=t.drafts_[0];return e!==void 0&&e!==n?(n[h].modified_&&(oe(t),_(4)),k(e)&&(e=q(t,e),t.parent_||V(t,e)),t.patches_&&j("Patches").generateReplacementPatches_(n[h].base_,e,t.patches_,t.inversePatches_)):e=q(t,n,[]),oe(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==Fe?e:void 0}function q(e,t,n){if(Y(t))return t;const r=t[h];if(!r)return H(t,(s,o)=>Se(e,r,t,s,o,n)),t;if(r.scope_!==e)return t;if(!r.modified_)return V(e,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;const s=r.copy_;let o=s,a=!1;r.type_===3&&(o=new Set(s),s.clear(),a=!0),H(o,(l,c)=>Se(e,r,s,l,c,n,a)),V(e,s,!1),n&&e.patches_&&j("Patches").generatePatches_(r,n,e.patches_,e.inversePatches_)}return r.copy_}function Se(e,t,n,r,s,o,a){if(C(s)){const l=o&&t&&t.type_!==3&&!re(t.assigned_,r)?o.concat(r):void 0,c=q(e,s,l);if(Le(n,r,c),C(c))e.canAutoFreeze_=!1;else return}else a&&n.add(s);if(k(s)&&!Y(s)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;q(e,s),(!t||!t.scope_.parent_)&&typeof r!="symbol"&&(F(n)?n.has(r):Object.prototype.propertyIsEnumerable.call(n,r))&&V(e,s)}}function V(e,t,n=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&me(t,n)}function Nt(e,t){const n=Array.isArray(e),r={type_:n?1:0,scope_:t?t.scope_:Ue(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let s=r,o=pe;n&&(s=[r],o=T);const{revoke:a,proxy:l}=Proxy.revocable(s,o);return r.draft_=l,r.revoke_=a,l}var pe={get(e,t){if(t===h)return e;const n=S(e);if(!re(n,t))return Ct(e,n,t);const r=n[t];return e.finalized_||!k(r)?r:r===ee(e.base_,t)?(te(e),e.copy_[t]=ce(r,e)):r},has(e,t){return t in S(e)},ownKeys(e){return Reflect.ownKeys(S(e))},set(e,t,n){const r=Ie(S(e),t);if(r?.set)return r.set.call(e.draft_,n),!0;if(!e.modified_){const s=ee(S(e),t),o=s?.[h];if(o&&o.base_===n)return e.copy_[t]=n,e.assigned_[t]=!1,!0;if(Pt(n,s)&&(n!==void 0||re(e.base_,t)))return!0;te(e),ie(e)}return e.copy_[t]===n&&(n!==void 0||t in e.copy_)||Number.isNaN(n)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=n,e.assigned_[t]=!0),!0},deleteProperty(e,t){return ee(e.base_,t)!==void 0||t in e.base_?(e.assigned_[t]=!1,te(e),ie(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){const n=S(e),r=Reflect.getOwnPropertyDescriptor(n,t);return r&&{writable:!0,configurable:e.type_!==1||t!=="length",enumerable:r.enumerable,value:n[t]}},defineProperty(){_(11)},getPrototypeOf(e){return N(e.base_)},setPrototypeOf(){_(12)}},T={};H(pe,(e,t)=>{T[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}});T.deleteProperty=function(e,t){return T.set.call(this,e,t,void 0)};T.set=function(e,t,n){return pe.set.call(this,e[0],t,n,e[0])};function ee(e,t){const n=e[h];return(n?S(n):e)[t]}function Ct(e,t,n){const r=Ie(t,n);return r?"value"in r?r.value:r.get?.call(e.draft_):void 0}function Ie(e,t){if(!(t in e))return;let n=N(e);for(;n;){const r=Object.getOwnPropertyDescriptor(n,t);if(r)return r;n=N(n)}}function ie(e){e.modified_||(e.modified_=!0,e.parent_&&ie(e.parent_))}function te(e){e.copy_||(e.copy_=se(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var Et=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(t,n,r)=>{if(typeof t=="function"&&typeof n!="function"){const o=n;n=t;const a=this;return function(c=o,...u){return a.produce(c,f=>n.call(this,f,...u))}}typeof n!="function"&&_(6),r!==void 0&&typeof r!="function"&&_(7);let s;if(k(t)){const o=we(this),a=ce(t,void 0);let l=!0;try{s=n(a),l=!1}finally{l?oe(o):ae(o)}return ge(o,r),Pe(s,o)}else if(!t||typeof t!="object"){if(s=n(t),s===void 0&&(s=t),s===Fe&&(s=void 0),this.autoFreeze_&&me(s,!0),r){const o=[],a=[];j("Patches").generateReplacementPatches_(t,s,o,a),r(o,a)}return s}else _(1,t)},this.produceWithPatches=(t,n)=>{if(typeof t=="function")return(a,...l)=>this.produceWithPatches(a,c=>t(c,...l));let r,s;return[this.produce(t,n,(a,l)=>{r=a,s=l}),r,s]},typeof e?.autoFreeze=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof e?.useStrictShallowCopy=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){k(e)||_(8),C(e)&&(e=Rt(e));const t=we(this),n=ce(e,void 0);return n[h].isManual_=!0,ae(t),n}finishDraft(e,t){const n=e&&e[h];(!n||!n.isManual_)&&_(9);const{scope_:r}=n;return ge(r,t),Pe(void 0,r)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let n;for(n=t.length-1;n>=0;n--){const s=t[n];if(s.path.length===0&&s.op==="replace"){e=s.value;break}}n>-1&&(t=t.slice(n+1));const r=j("Patches").applyPatches_;return C(e)?r(e,t):this.produce(e,s=>r(s,t))}};function ce(e,t){const n=F(e)?j("MapSet").proxyMap_(e,t):W(e)?j("MapSet").proxySet_(e,t):Nt(e,t);return(t?t.scope_:Ue()).drafts_.push(n),n}function Rt(e){return C(e)||_(10,e),Ge(e)}function Ge(e){if(!k(e)||Y(e))return e;const t=e[h];let n;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,n=se(e,t.scope_.immer_.useStrictShallowCopy_)}else n=se(e,!0);return H(n,(r,s)=>{Le(n,r,Ge(s))}),t&&(t.finalized_=!1),n}var Dt=new Et,Ot=Dt.produce;const zt=e=>(t,n,r)=>(r.setState=(s,o,...a)=>{const l=typeof s=="function"?Ot(s):s;return t(l,o,...a)},e(r.setState,n,r)),Mt=zt,Tt="crossbeat-db",$t=1,y="patterns";class Ft{db=null;async init(){return new Promise((t,n)=>{const r=indexedDB.open(Tt,$t);r.onerror=()=>{console.error("Failed to open IndexedDB:",r.error),n(r.error)},r.onsuccess=()=>{this.db=r.result,console.log("IndexedDB initialized"),t()},r.onupgradeneeded=s=>{const o=s.target.result;if(!o.objectStoreNames.contains(y)){const a=o.createObjectStore(y,{keyPath:"id"});a.createIndex("created","created",{unique:!1}),a.createIndex("name","name",{unique:!1}),console.log("Created patterns object store")}}})}async savePattern(t){return this.db||await this.init(),new Promise((n,r)=>{const a=this.db.transaction([y],"readwrite").objectStore(y).put(t);a.onsuccess=()=>{console.log("Pattern saved:",t.name),n()},a.onerror=()=>{console.error("Failed to save pattern:",a.error),r(a.error)}})}async loadPattern(t){return this.db||await this.init(),new Promise((n,r)=>{const a=this.db.transaction([y],"readonly").objectStore(y).get(t);a.onsuccess=()=>{n(a.result||null)},a.onerror=()=>{console.error("Failed to load pattern:",a.error),r(a.error)}})}async getAllPatterns(){return this.db||await this.init(),new Promise((t,n)=>{const o=this.db.transaction([y],"readonly").objectStore(y).getAll();o.onsuccess=()=>{const a=o.result||[];a.sort((l,c)=>c.created-l.created),t(a)},o.onerror=()=>{console.error("Failed to get patterns:",o.error),n(o.error)}})}async deletePattern(t){return this.db||await this.init(),new Promise((n,r)=>{const a=this.db.transaction([y],"readwrite").objectStore(y).delete(t);a.onsuccess=()=>{console.log("Pattern deleted:",t),n()},a.onerror=()=>{console.error("Failed to delete pattern:",a.error),r(a.error)}})}async clearAll(){return this.db||await this.init(),new Promise((t,n)=>{const o=this.db.transaction([y],"readwrite").objectStore(y).clear();o.onsuccess=()=>{console.log("All patterns cleared"),t()},o.onerror=()=>{console.error("Failed to clear patterns:",o.error),n(o.error)}})}}const ne=new Ft,ke=()=>{const e=[{id:"0",name:"Kick",synthType:"kick",volume:1,mute:!1,solo:!1,steps:[],synthParams:{pitch:60,decay:.5,tone:.5}},{id:"1",name:"Snare",synthType:"snare",volume:.8,mute:!1,solo:!1,steps:[],synthParams:{pitch:200,decay:.15,tone:.5}},{id:"2",name:"Closed HH",synthType:"hihat",volume:.6,mute:!1,solo:!1,steps:[],synthParams:{pitch:8e3,decay:.05,tone:.7}},{id:"3",name:"Open HH",synthType:"hihat",volume:.5,mute:!1,solo:!1,steps:[],synthParams:{pitch:8e3,decay:.15,tone:.6}},{id:"4",name:"Clap",synthType:"clap",volume:.7,mute:!1,solo:!1,steps:[],synthParams:{pitch:1e3,decay:.1,tone:.6}},{id:"5",name:"Rim",synthType:"rim",volume:.7,mute:!1,solo:!1,steps:[],synthParams:{pitch:400,decay:.08,tone:.7}},{id:"6",name:"Tom",synthType:"tom",volume:.8,mute:!1,solo:!1,steps:[],synthParams:{pitch:150,decay:.4,tone:.5}},{id:"7",name:"Perc",synthType:"perc1",volume:.6,mute:!1,solo:!1,steps:[],synthParams:{pitch:300,decay:.12,tone:.5}}];return e.forEach(t=>{t.steps=Array.from({length:16},()=>({active:!1,velocity:100,probability:1,microTiming:0}))}),{id:crypto.randomUUID(),name:"New Pattern",bpm:120,swing:0,tracks:e,steps:16,created:Date.now(),version:1}},E=gt()(Mt((e,t)=>({pattern:ke(),isPlaying:!1,currentStep:0,bpm:120,savedPatterns:[],toggleStep:(n,r)=>e(s=>{s.pattern.tracks[n].steps[r].active=!s.pattern.tracks[n].steps[r].active}),setStepVelocity:(n,r,s)=>e(o=>{o.pattern.tracks[n].steps[r].velocity=Math.max(0,Math.min(127,s))}),setStepProbability:(n,r,s)=>e(o=>{o.pattern.tracks[n].steps[r].probability=Math.max(0,Math.min(1,s))}),setBpm:n=>e(r=>{r.pattern.bpm=Math.max(60,Math.min(300,n)),r.bpm=r.pattern.bpm}),setSwing:n=>e(r=>{r.pattern.swing=Math.max(0,Math.min(1,n))}),togglePlay:()=>e(n=>{n.isPlaying=!n.isPlaying,n.isPlaying||(n.currentStep=0)}),setCurrentStep:n=>e(r=>{r.currentStep=n%r.pattern.steps}),setTrackVolume:(n,r)=>e(s=>{s.pattern.tracks[n].volume=Math.max(0,Math.min(1,r))}),toggleMute:n=>e(r=>{r.pattern.tracks[n].mute=!r.pattern.tracks[n].mute}),toggleSolo:n=>e(r=>{r.pattern.tracks[n].solo=!r.pattern.tracks[n].solo}),setSynthParameter:(n,r,s)=>e(o=>{o.pattern.tracks[n].synthParams[r]=s}),clearPattern:()=>e(n=>{n.pattern.tracks.forEach(r=>{r.steps.forEach(s=>{s.active=!1})})}),randomizePattern:()=>e(n=>{n.pattern.tracks.forEach((r,s)=>{r.steps.forEach(o=>{const a=s===0?.3:s===1?.2:s===2?.5:.25;o.active=Math.random()<a,o.active&&(o.velocity=80+Math.floor(Math.random()*47),o.probability=.7+Math.random()*.3)})})}),saveCurrentPattern:async()=>{const n=t().pattern;await ne.savePattern(n),await t().loadSavedPatterns(),console.log("Pattern saved:",n.name)},loadPattern:n=>e(r=>{r.pattern=n,r.bpm=n.bpm,r.isPlaying=!1,r.currentStep=0}),deletePattern:async n=>{await ne.deletePattern(n),await t().loadSavedPatterns()},loadSavedPatterns:async()=>{const n=await ne.getAllPatterns();e(r=>{r.savedPatterns=n})},newPattern:()=>e(n=>{n.pattern=ke(),n.bpm=120,n.isPlaying=!1,n.currentStep=0}),setPatternName:n=>e(r=>{r.pattern.name=n}),duplicatePattern:()=>e(n=>{const r={...n.pattern,id:crypto.randomUUID(),name:`${n.pattern.name} (copy)`,created:Date.now()};n.pattern=r})}))),Kt=({onPlayClick:e})=>{const{isPlaying:t,bpm:n,pattern:r,setBpm:s,setSwing:o,clearPattern:a,randomizePattern:l}=E();return i.jsxs("div",{className:"transport",children:[i.jsx("div",{className:"transport-section",children:i.jsx("button",{className:`transport-button ${t?"playing":""}`,onClick:e,children:t?"â¸ Stop":"â–¶ Play"})}),i.jsxs("div",{className:"transport-section",children:[i.jsxs("label",{children:["BPM",i.jsx("input",{type:"number",min:"60",max:"300",value:n,onChange:c=>s(parseInt(c.target.value)||120),className:"transport-input"})]}),i.jsxs("label",{children:["Swing",i.jsx("input",{type:"range",min:"0",max:"100",value:r.swing*100,onChange:c=>o(parseInt(c.target.value)/100),className:"transport-slider"}),i.jsxs("span",{className:"transport-value",children:[Math.round(r.swing*100),"%"]})]})]}),i.jsxs("div",{className:"transport-section",children:[i.jsx("button",{className:"transport-button secondary",onClick:a,children:"Clear"}),i.jsx("button",{className:"transport-button secondary",onClick:l,children:"Randomize"})]})]})},Wt=({currentStep:e,selectedTrackIndex:t,onTrackSelect:n})=>{const{pattern:r,toggleStep:s,toggleMute:o,toggleSolo:a,setTrackVolume:l}=E();return i.jsx("div",{className:"grid-container",children:r.tracks.map((c,u)=>i.jsxs("div",{className:`grid-row ${t===u?"selected":""}`,onClick:()=>n(u),children:[i.jsxs("div",{className:"track-header",children:[i.jsxs("div",{className:"track-info",children:[i.jsx("span",{className:"track-name",children:c.name}),i.jsx("span",{className:"track-type",children:c.synthType})]}),i.jsxs("div",{className:"track-controls",children:[i.jsx("button",{className:`track-button ${c.mute?"active":""}`,onClick:f=>{f.stopPropagation(),o(u)},title:"Mute",children:"M"}),i.jsx("button",{className:`track-button ${c.solo?"active":""}`,onClick:f=>{f.stopPropagation(),a(u)},title:"Solo",children:"S"}),i.jsx("input",{type:"range",min:"0",max:"100",value:c.volume*100,onChange:f=>l(u,parseInt(f.target.value)/100),onClick:f=>f.stopPropagation(),className:"track-volume",title:"Volume"})]})]}),i.jsx("div",{className:"steps-container",children:c.steps.map((f,m)=>i.jsx("button",{className:`step ${f.active?"active":""} ${m===e?"current":""} ${m%4===0?"beat":""}`,onClick:w=>{w.stopPropagation(),s(u,m)},title:`Step ${m+1}
Velocity: ${f.velocity}
Probability: ${Math.round(f.probability*100)}%`,children:i.jsx("div",{className:"step-indicator",style:{opacity:f.velocity/127}})},m))})]},c.id))})};class At{context=null;masterGain=null;synths=new Map;initialized=!1;async initialize(){this.initialized||(this.context=new AudioContext,this.masterGain=this.context.createGain(),this.masterGain.gain.value=.8,this.masterGain.connect(this.context.destination),this.initializeSynths(),this.context.state==="suspended"&&await this.context.resume(),this.initialized=!0,console.log("Audio engine initialized",{sampleRate:this.context.sampleRate,state:this.context.state}))}initializeSynths(){if(!this.context||!this.masterGain)return;const t=new Be(this.context),n=new He(this.context),r=new qe(this.context),s=new Ve(this.context),o=new Je(this.context),a=new Ke(this.context),l=new he(this.context),c=new he(this.context);t.connect(this.masterGain),n.connect(this.masterGain),r.connect(this.masterGain),s.connect(this.masterGain),o.connect(this.masterGain),a.connect(this.masterGain),l.connect(this.masterGain),c.connect(this.masterGain),this.synths.set("kick",t),this.synths.set("snare",n),this.synths.set("hihat",r),this.synths.set("clap",s),this.synths.set("rim",o),this.synths.set("tom",a),this.synths.set("perc1",l),this.synths.set("perc2",c),console.log("Initialized 8 synthesis engines")}triggerDrum(t,n,r){if(!this.context||!this.initialized){console.warn("Audio engine not initialized");return}const s=this.synths.get(t);if(!s){console.warn(`Synth type not found: ${t}`);return}const o=this.context.currentTime;s.trigger(o,n/127,r)}updateSynthParams(t,n){const r=this.synths.get(t);r&&Object.entries(n).forEach(([s,o])=>{r.setParameter(s,o)})}getCurrentTime(){return this.context?.currentTime??0}getContext(){return this.context}isInitialized(){return this.initialized}setMasterVolume(t){this.masterGain&&this.masterGain.gain.setValueAtTime(Math.max(0,Math.min(1,t)),this.context?.currentTime??0)}dispose(){this.synths.forEach(t=>t.dispose()),this.synths.clear(),this.masterGain?.disconnect(),this.context?.close(),this.initialized=!1}}const Lt=new At,Ut=({label:e,value:t,min:n,max:r,onChange:s,unit:o="",step:a=.01})=>{const[l,c]=b.useState(!1),u=b.useRef(0),f=b.useRef(0),m=x=>(x-n)/(r-n)*270-135,w=b.useCallback(x=>{c(!0),u.current=x.clientY,f.current=t,x.preventDefault()},[t]),P=b.useCallback(x=>{if(!l)return;const L=u.current-x.clientY,O=(r-n)/300;let g=f.current+L*O;a&&(g=Math.round(g/a)*a),g=Math.max(n,Math.min(r,g)),s(g)},[l,n,r,a,s]),D=b.useCallback(()=>{c(!1)},[]);z.useEffect(()=>{if(l)return window.addEventListener("mousemove",P),window.addEventListener("mouseup",D),()=>{window.removeEventListener("mousemove",P),window.removeEventListener("mouseup",D)}},[l,P,D]);const X=()=>{const x=(n+r)/2;s(x)},Q=m(t),A=o==="Hz"||o==="ms"?Math.round(t):t.toFixed(2);return i.jsxs("div",{className:"knob-container",children:[i.jsx("div",{className:`knob ${l?"dragging":""}`,onMouseDown:w,onDoubleClick:X,title:`${e}: ${A}${o}
Drag to adjust, double-click to reset`,children:i.jsxs("svg",{width:"60",height:"60",viewBox:"0 0 60 60",children:[i.jsx("circle",{cx:"30",cy:"30",r:"25",fill:"none",stroke:"#0f3460",strokeWidth:"3"}),i.jsx("circle",{cx:"30",cy:"30",r:"25",fill:"none",stroke:"url(#knobGradient)",strokeWidth:"3",strokeDasharray:`${(t-n)/(r-n)*157} 157`,strokeLinecap:"round",transform:"rotate(-135 30 30)"}),i.jsx("defs",{children:i.jsxs("linearGradient",{id:"knobGradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[i.jsx("stop",{offset:"0%",stopColor:"#00adb5"}),i.jsx("stop",{offset:"100%",stopColor:"#00d4dd"})]})}),i.jsx("circle",{cx:"30",cy:"30",r:"20",fill:"#16213e"}),i.jsx("line",{x1:"30",y1:"30",x2:"30",y2:"12",stroke:"#00adb5",strokeWidth:"3",strokeLinecap:"round",transform:`rotate(${Q} 30 30)`})]})}),i.jsx("div",{className:"knob-label",children:e}),i.jsxs("div",{className:"knob-value",children:[A,o]})]})},Yt=({selectedTrackIndex:e})=>{const{pattern:t,setSynthParameter:n}=E(),r=t.tracks[e];if(!r)return null;const s=(l,c)=>{n(e,l,c),Lt.updateSynthParams(r.synthType,{[l]:c}),console.log(`Updated ${r.name} ${l}:`,c)},a=(()=>{switch(r.synthType){case"kick":return[{key:"pitch",label:"Pitch",min:20,max:200,unit:"Hz"},{key:"decay",label:"Decay",min:.1,max:2,unit:"s"},{key:"tone",label:"Tone",min:0,max:1,unit:""},{key:"subLevel",label:"Sub",min:0,max:1,unit:""},{key:"clickLevel",label:"Click",min:0,max:1,unit:""},{key:"pitchDecay",label:"P.Env",min:.01,max:.2,unit:"s"},{key:"saturation",label:"Drive",min:0,max:1,unit:""}];case"snare":return[{key:"pitch",label:"Pitch",min:100,max:800,unit:"Hz"},{key:"decay",label:"Decay",min:.05,max:.5,unit:"s"},{key:"tone",label:"Tone",min:0,max:1,unit:""},{key:"bodyFreq",label:"Body",min:100,max:800,unit:"Hz"},{key:"noiseLevel",label:"Noise",min:0,max:1,unit:""},{key:"resonance",label:"Reso",min:1,max:20,unit:""}];case"hihat":return[{key:"pitch",label:"Pitch",min:5e3,max:12e3,unit:"Hz"},{key:"decay",label:"Decay",min:.02,max:.5,unit:"s"},{key:"tone",label:"Tone",min:0,max:1,unit:""},{key:"color",label:"Color",min:5e3,max:12e3,unit:"Hz"},{key:"metallic",label:"Metal",min:0,max:1,unit:""}];case"clap":return[{key:"pitch",label:"Pitch",min:500,max:2e3,unit:"Hz"},{key:"decay",label:"Decay",min:.05,max:.3,unit:"s"},{key:"tone",label:"Tone",min:0,max:1,unit:""},{key:"layers",label:"Layers",min:2,max:5,unit:""},{key:"spread",label:"Spread",min:.01,max:.05,unit:"s"},{key:"resonance",label:"Reso",min:1,max:10,unit:""}];case"rim":return[{key:"pitch",label:"Pitch",min:200,max:800,unit:"Hz"},{key:"decay",label:"Decay",min:.03,max:.15,unit:"s"},{key:"tone",label:"Tone",min:0,max:1,unit:""},{key:"resonance",label:"Reso",min:5,max:20,unit:""},{key:"noiseLevel",label:"Click",min:0,max:1,unit:""}];case"tom":return[{key:"pitch",label:"Pitch",min:60,max:300,unit:"Hz"},{key:"decay",label:"Decay",min:.1,max:1,unit:"s"},{key:"tone",label:"Tone",min:0,max:1,unit:""},{key:"pitchDecay",label:"P.Env",min:.02,max:.2,unit:"s"},{key:"pitchAmount",label:"P.Amt",min:1.5,max:4,unit:""},{key:"resonance",label:"Reso",min:1,max:10,unit:""}];case"perc1":case"perc2":return[{key:"pitch",label:"Pitch",min:100,max:1e3,unit:"Hz"},{key:"decay",label:"Decay",min:.05,max:.5,unit:"s"},{key:"tone",label:"Tone",min:0,max:1,unit:""},{key:"harmonics",label:"Harm",min:1.5,max:4,unit:""},{key:"resonance",label:"Reso",min:2,max:15,unit:""}];default:return[{key:"pitch",label:"Pitch",min:100,max:1e3,unit:"Hz"},{key:"decay",label:"Decay",min:.05,max:1,unit:"s"},{key:"tone",label:"Tone",min:0,max:1,unit:""}]}})();return i.jsxs("div",{className:"synth-controls",children:[i.jsx("div",{className:"synth-controls-header",children:i.jsxs("div",{className:"synth-info",children:[i.jsx("h3",{children:r.name}),i.jsxs("span",{className:"synth-type",children:[r.synthType," synthesis"]})]})}),i.jsx("div",{className:"synth-controls-grid",children:a.map(l=>i.jsx(Ut,{label:l.label,value:r.synthParams[l.key]??(l.min+l.max)/2,min:l.min,max:l.max,unit:l.unit,onChange:c=>s(l.key,c)},l.key))}),i.jsxs("div",{className:"synth-controls-info",children:[i.jsx("button",{className:"preset-button",onClick:()=>{a.forEach(l=>{const c=(l.min+l.max)/2;s(l.key,c)})},children:"Reset to Default"}),i.jsx("span",{className:"tip",children:"Drag knobs to adjust â€¢ Double-click to reset"})]})]})},It=({isOpen:e,onClose:t})=>{const{savedPatterns:n,loadPattern:r,deletePattern:s}=E(),o=c=>{r(c),t()},a=async(c,u)=>{u.stopPropagation(),confirm("Delete this pattern?")&&await s(c)},l=c=>new Date(c).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"});return e?i.jsx("div",{className:"pattern-browser-overlay",onClick:t,children:i.jsxs("div",{className:"pattern-browser",onClick:c=>c.stopPropagation(),children:[i.jsxs("div",{className:"pattern-browser-header",children:[i.jsx("h2",{children:"Pattern Library"}),i.jsx("button",{className:"close-button",onClick:t,children:"Ã—"})]}),i.jsx("div",{className:"pattern-browser-content",children:n.length===0?i.jsxs("div",{className:"empty-state",children:[i.jsx("p",{children:"No saved patterns yet"}),i.jsx("span",{children:"Create a pattern and click Save to add it to your library"})]}):i.jsx("div",{className:"pattern-list",children:n.map(c=>i.jsxs("div",{className:"pattern-item",onClick:()=>o(c),children:[i.jsxs("div",{className:"pattern-item-header",children:[i.jsx("h3",{children:c.name}),i.jsx("button",{className:"delete-button",onClick:u=>a(c.id,u),title:"Delete pattern",children:"ðŸ—‘ï¸"})]}),i.jsxs("div",{className:"pattern-item-details",children:[i.jsxs("span",{className:"pattern-bpm",children:[c.bpm," BPM"]}),i.jsxs("span",{className:"pattern-swing",children:[Math.round(c.swing*100),"% swing"]}),i.jsxs("span",{className:"pattern-steps",children:[c.steps," steps"]})]}),i.jsx("div",{className:"pattern-item-date",children:l(c.created)}),i.jsx("div",{className:"pattern-preview",children:c.tracks.slice(0,4).map(u=>i.jsx("div",{className:"preview-track",children:u.steps.map((f,m)=>i.jsx("div",{className:`preview-step ${f.active?"active":""}`},m))},u.id))})]},c.id))})})]})}):null};function Gt(e){const t=JSON.stringify(e,null,2),n=new Blob([t],{type:"application/json"}),r=URL.createObjectURL(n),s=document.createElement("a");s.href=r,s.download=`${e.name.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_${Date.now()}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(r),console.log("Pattern exported:",e.name)}function Bt(e){return new Promise((t,n)=>{const r=new FileReader;r.onload=s=>{try{const o=s.target?.result,a=JSON.parse(o);if(!a.id||!a.name||!a.tracks)throw new Error("Invalid pattern file structure");a.id=crypto.randomUUID(),a.created=Date.now(),a.name=`${a.name} (imported)`,console.log("Pattern imported:",a.name),t(a)}catch(o){console.error("Failed to parse pattern JSON:",o),n(new Error("Invalid pattern file"))}},r.onerror=()=>{n(new Error("Failed to read file"))},r.readAsText(e)})}function Ht(e){try{const t={n:e.name,b:e.bpm,s:e.swing,st:e.steps,t:e.tracks.map(s=>({n:s.name,t:s.synthType,v:s.volume,m:s.mute,so:s.solo,p:s.synthParams,s:s.steps.map(o=>({a:o.active,v:o.velocity,pr:o.probability,mt:o.microTiming,pm:o.parameters}))}))},n=JSON.stringify(t);return btoa(n)}catch(t){throw console.error("Failed to encode pattern:",t),new Error("Failed to encode pattern for sharing")}}function qt(e){try{const t=atob(e),n=JSON.parse(t);return{name:n.n,bpm:n.b,swing:n.s,steps:n.st,tracks:n.t.map((r,s)=>({id:String(s),name:r.n,synthType:r.t,volume:r.v,mute:r.m,solo:r.so,synthParams:r.p,steps:r.s.map(o=>({active:o.a,velocity:o.v,probability:o.pr,microTiming:o.mt,parameters:o.pm}))}))}}catch(t){throw console.error("Failed to decode pattern:",t),new Error("Invalid pattern URL")}}function Vt(e){const t=Ht(e);return`${window.location.origin+window.location.pathname}#pattern=${t}`}function Xt(){const e=window.location.hash;if(!e.startsWith("#pattern="))return null;const t=e.substring(9);try{return qt(t)}catch(n){return console.error("Failed to load pattern from URL:",n),null}}const Qt=()=>{const{pattern:e,setPatternName:t,saveCurrentPattern:n,newPattern:r,duplicatePattern:s}=E(),[o,a]=b.useState(!1),[l,c]=b.useState(!1),[u,f]=b.useState(!1),m=b.useRef(null),w=async()=>{await n(),c(!1)},P=()=>{confirm("Create new pattern? Unsaved changes will be lost.")&&(r(),c(!1))},D=()=>{s(),c(!1)},X=()=>{Gt(e),c(!1)},Q=()=>{m.current?.click()},A=async v=>{const O=v.target.files?.[0];if(O){try{const g=await Bt(O);E.getState().loadPattern(g),c(!1)}catch(g){alert("Failed to import pattern: "+g.message)}m.current&&(m.current.value="")}},x=async()=>{const v=Vt(e);try{await navigator.clipboard.writeText(v),alert("Pattern URL copied to clipboard!")}catch{prompt("Copy this URL to share your pattern:",v)}c(!1)},L=v=>{t(v)};return i.jsxs("div",{className:"pattern-menu",children:[i.jsx("div",{className:"pattern-name-container",children:u?i.jsx("input",{type:"text",className:"pattern-name-input",value:e.name,onChange:v=>L(v.target.value),onBlur:()=>f(!1),onKeyDown:v=>v.key==="Enter"&&f(!1),autoFocus:!0}):i.jsx("div",{className:"pattern-name",onClick:()=>f(!0),title:"Click to edit pattern name",children:e.name})}),i.jsxs("div",{className:"pattern-menu-buttons",children:[i.jsx("button",{className:"pattern-menu-button",onClick:w,title:"Save pattern",children:"ðŸ’¾ Save"}),i.jsx("button",{className:"pattern-menu-button",onClick:()=>a(!0),title:"Load pattern",children:"ðŸ“ Load"}),i.jsxs("div",{className:"pattern-menu-dropdown",children:[i.jsx("button",{className:"pattern-menu-button",onClick:()=>c(!l),title:"More options",children:"â‹®"}),l&&i.jsxs("div",{className:"dropdown-menu",children:[i.jsx("button",{onClick:P,children:"ðŸ†• New"}),i.jsx("button",{onClick:D,children:"ðŸ“‹ Duplicate"}),i.jsx("div",{className:"menu-divider"}),i.jsx("button",{onClick:x,children:"ðŸ”— Share URL"}),i.jsx("button",{onClick:X,children:"â¬‡ï¸ Export JSON"}),i.jsx("button",{onClick:Q,children:"â¬†ï¸ Import JSON"})]})]})]}),i.jsx("input",{ref:m,type:"file",accept:".json",style:{display:"none"},onChange:A}),i.jsx(It,{isOpen:o,onClose:()=>a(!1)}),l&&i.jsx("div",{className:"menu-backdrop",onClick:()=>c(!1)})]})};export{Wt as G,Qt as P,z as R,Yt as S,Kt as T,Lt as a,i as j,Xt as l,ne as p,b as r,E as u};
