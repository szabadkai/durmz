class P{context;outputNode;parameters;voices=new Set;constructor(e){this.context=e,this.outputNode=e.createGain(),this.outputNode.gain.value=1,this.parameters=new Map,this.initializeDefaultParameters()}setParameter(e,c){this.parameters.set(e,c)}getParameter(e,c=0){return this.parameters.get(e)??c}connect(e){this.outputNode.connect(e)}disconnect(){this.outputNode.disconnect()}dispose(){this.voices.forEach(e=>e.stop(this.context.currentTime)),this.voices.clear(),this.disconnect()}createEnvelope(e,c,t,u,T){e.setValueAtTime(t,c),e.exponentialRampToValueAtTime(Math.max(u,.001),c+T)}smoothParameter(e,c,t,u=.01){e.setTargetAtTime(c,t,u)}}class D extends P{initializeDefaultParameters(){this.parameters.set("pitch",60),this.parameters.set("decay",.5),this.parameters.set("tone",.5),this.parameters.set("subLevel",.8),this.parameters.set("clickLevel",.3),this.parameters.set("pitchDecay",.05),this.parameters.set("saturation",.3)}trigger(e,c,t){const u=t?.pitch??this.getParameter("pitch",60),T=t?.decay??this.getParameter("decay",.5),m=t?.tone??this.getParameter("tone",.5),x=t?.subLevel??this.getParameter("subLevel",.8),g=t?.clickLevel??this.getParameter("clickLevel",.3),d=t?.pitchDecay??this.getParameter("pitchDecay",.05),o=t?.saturation??this.getParameter("saturation",.3),n=[],a=this.context.createOscillator(),h=this.context.createGain(),p=u*2.5;a.frequency.setValueAtTime(p,e),a.frequency.exponentialRampToValueAtTime(u,e+d),a.type="sine",h.gain.setValueAtTime(x*c,e),this.createEnvelope(h.gain,e,x*c,.001,T),a.connect(h),n.push(a,h);const s=this.context.createOscillator(),i=this.context.createGain(),l=this.context.createBiquadFilter();s.frequency.setValueAtTime(u*8,e),s.frequency.exponentialRampToValueAtTime(u*2,e+.01),s.type="sine",l.type="highpass",l.frequency.setValueAtTime(1e3,e),l.Q.setValueAtTime(1,e),i.gain.setValueAtTime(g*c*m,e),this.createEnvelope(i.gain,e,g*c*m,.001,.05),s.connect(l),l.connect(i),n.push(s,l,i);const r=this.context.createWaveShaper();r.curve=this.createSaturationCurve(o),r.oversample="2x",n.push(r);const f=this.context.createGain();f.gain.setValueAtTime(.8,e),n.push(f),h.connect(r),i.connect(r),r.connect(f),f.connect(this.outputNode),a.start(e),s.start(e);const y=e+T+.1;a.stop(y),s.stop(y);const A={nodes:n,startTime:e,endTime:y,stop:V=>{n.forEach(v=>{if(v instanceof AudioScheduledSourceNode)try{v.stop(V)}catch{}v.disconnect()}),this.voices.delete(A)}};this.voices.add(A),setTimeout(()=>{this.voices.has(A)&&A.stop(this.context.currentTime)},(y-this.context.currentTime)*1e3+100)}createSaturationCurve(e){const t=new ArrayBuffer(16384),u=new Float32Array(t),T=Math.PI/180;for(let m=0;m<4096;m++){const x=m*2/4096-1,g=e*100;u[m]=(3+g)*x*20*T/(Math.PI+g*Math.abs(x)),u[m]=Math.max(-1,Math.min(1,u[m]))}return u}}class N extends P{noiseBuffer=null;constructor(e){super(e),this.createNoiseBuffer()}initializeDefaultParameters(){this.parameters.set("pitch",200),this.parameters.set("decay",.15),this.parameters.set("tone",.5),this.parameters.set("bodyFreq",250),this.parameters.set("noiseLevel",.7),this.parameters.set("bodyDecay",.12),this.parameters.set("noiseDecay",.08),this.parameters.set("resonance",8)}createNoiseBuffer(){const e=this.context.sampleRate*2;this.noiseBuffer=this.context.createBuffer(1,e,this.context.sampleRate);const c=this.noiseBuffer.getChannelData(0);for(let t=0;t<e;t++)c[t]=Math.random()*2-1}trigger(e,c,t){const u=t?.tone??this.getParameter("tone",.5),T=t?.bodyFreq??this.getParameter("bodyFreq",250),m=t?.noiseLevel??this.getParameter("noiseLevel",.7),x=t?.bodyDecay??this.getParameter("bodyDecay",.12),g=t?.noiseDecay??this.getParameter("noiseDecay",.08),d=t?.resonance??this.getParameter("resonance",8),o=[],n=this.context.createOscillator(),a=this.context.createBiquadFilter(),h=this.context.createGain();if(n.type="triangle",n.frequency.setValueAtTime(T,e),a.type="bandpass",a.frequency.setValueAtTime(T,e),a.Q.setValueAtTime(d,e),h.gain.setValueAtTime(c*u,e),this.createEnvelope(h.gain,e,c*u,.001,x),n.connect(a),a.connect(h),o.push(n,a,h),this.noiseBuffer){const l=this.context.createBufferSource(),r=this.context.createBiquadFilter(),f=this.context.createGain();l.buffer=this.noiseBuffer,r.type="highpass",r.frequency.setValueAtTime(3e3,e),r.Q.setValueAtTime(1,e),f.gain.setValueAtTime(c*m,e),this.createEnvelope(f.gain,e,c*m,.001,g),l.connect(r),r.connect(f),o.push(l,r,f),l.start(e),l.stop(e+g+.1)}const p=this.context.createGain();p.gain.setValueAtTime(.7,e),o.push(p),h.connect(p),this.noiseBuffer&&o[o.length-4].connect(p),p.connect(this.outputNode),n.start(e);const s=e+Math.max(x,g)+.1;n.stop(s);const i={nodes:o,startTime:e,endTime:s,stop:l=>{o.forEach(r=>{if(r instanceof AudioScheduledSourceNode)try{r.stop(l)}catch{}r.disconnect()}),this.voices.delete(i)}};this.voices.add(i),setTimeout(()=>{this.voices.has(i)&&i.stop(this.context.currentTime)},(s-this.context.currentTime)*1e3+100)}}class F extends P{noiseBuffer=null;activeChokeGroup=new Map;constructor(e){super(e),this.createNoiseBuffer()}initializeDefaultParameters(){this.parameters.set("pitch",8e3),this.parameters.set("decay",.05),this.parameters.set("tone",.7),this.parameters.set("color",8e3),this.parameters.set("metallic",.6),this.parameters.set("chokeGroup",0)}createNoiseBuffer(){const e=this.context.sampleRate*2;this.noiseBuffer=this.context.createBuffer(1,e,this.context.sampleRate);const c=this.noiseBuffer.getChannelData(0);for(let t=0;t<e;t++)c[t]=Math.random()*2-1}trigger(e,c,t){const u=t?.decay??this.getParameter("decay",.05),T=t?.tone??this.getParameter("tone",.7),m=t?.color??this.getParameter("color",8e3),x=t?.metallic??this.getParameter("metallic",.6),g=t?.chokeGroup??this.getParameter("chokeGroup",0);if(this.activeChokeGroup.has(g)&&(this.activeChokeGroup.get(g)?.stop(e),this.activeChokeGroup.delete(g)),!this.noiseBuffer)return;const d=[],o=this.context.createBufferSource();o.buffer=this.noiseBuffer,d.push(o);const n=this.context.createBiquadFilter();n.type="bandpass",n.frequency.setValueAtTime(m*.7,e),n.Q.setValueAtTime(20*x,e),d.push(n);const a=this.context.createBiquadFilter();a.type="bandpass",a.frequency.setValueAtTime(m*1.2,e),a.Q.setValueAtTime(15*x,e),d.push(a);const h=this.context.createBiquadFilter();h.type="bandpass",h.frequency.setValueAtTime(m*1.8,e),h.Q.setValueAtTime(10*x,e),d.push(h);const p=this.context.createBiquadFilter();p.type="highpass",p.frequency.setValueAtTime(5e3,e),p.Q.setValueAtTime(.5,e),d.push(p);const s=this.context.createGain();s.gain.setValueAtTime(c*T,e),this.createEnvelope(s.gain,e,c*T,.001,u),d.push(s);const i=this.context.createGain();i.gain.setValueAtTime(.5,e),d.push(i),o.connect(n),o.connect(a),o.connect(h),n.connect(p),a.connect(p),h.connect(p),p.connect(s),s.connect(i),i.connect(this.outputNode),o.start(e);const l=e+u+.05;o.stop(l);const r={nodes:d,startTime:e,endTime:l,stop:f=>{d.forEach(y=>{if(y instanceof AudioScheduledSourceNode)try{y.stop(f)}catch{}y.disconnect()}),this.voices.delete(r),this.activeChokeGroup.get(g)===r&&this.activeChokeGroup.delete(g)}};this.voices.add(r),this.activeChokeGroup.set(g,r),setTimeout(()=>{this.voices.has(r)&&r.stop(this.context.currentTime)},(l-this.context.currentTime)*1e3+100)}}class k extends P{noiseBuffer=null;constructor(e){super(e),this.createNoiseBuffer()}initializeDefaultParameters(){this.parameters.set("pitch",1e3),this.parameters.set("decay",.1),this.parameters.set("tone",.6),this.parameters.set("layers",3),this.parameters.set("spread",.02),this.parameters.set("resonance",2)}createNoiseBuffer(){const e=this.context.sampleRate*2;this.noiseBuffer=this.context.createBuffer(1,e,this.context.sampleRate);const c=this.noiseBuffer.getChannelData(0);for(let t=0;t<e;t++)c[t]=Math.random()*2-1}trigger(e,c,t){const u=t?.pitch??this.getParameter("pitch",1e3),T=t?.decay??this.getParameter("decay",.1),m=t?.tone??this.getParameter("tone",.6),x=t?.layers??this.getParameter("layers",3),g=t?.spread??this.getParameter("spread",.02),d=t?.resonance??this.getParameter("resonance",2);if(!this.noiseBuffer)return;const o=[],n=Math.floor(x);for(let s=0;s<n;s++){const i=e+s*g,l=c*(.7+s*.15),r=this.context.createBufferSource();r.buffer=this.noiseBuffer;const f=this.context.createBiquadFilter();f.type="bandpass",f.frequency.setValueAtTime(u*m,i),f.Q.setValueAtTime(d,i);const y=this.context.createGain();y.gain.setValueAtTime(l*.8,i);const A=T*(.8+s*.1);this.createEnvelope(y.gain,i,l*.8,.001,A),r.connect(f),f.connect(y),o.push(r,f,y),r.start(i),r.stop(i+A+.05)}const a=this.context.createGain();a.gain.setValueAtTime(.7,e),o.push(a),o.forEach(s=>{s instanceof GainNode&&s!==a&&s.connect(a)}),a.connect(this.outputNode);const h=e+T+g*n+.1,p={nodes:o,startTime:e,endTime:h,stop:s=>{o.forEach(i=>{if(i instanceof AudioScheduledSourceNode)try{i.stop(s)}catch{}i.disconnect()}),this.voices.delete(p)}};this.voices.add(p),setTimeout(()=>{this.voices.has(p)&&p.stop(this.context.currentTime)},(h-this.context.currentTime)*1e3+100)}}class E extends P{initializeDefaultParameters(){this.parameters.set("pitch",400),this.parameters.set("decay",.08),this.parameters.set("tone",.7),this.parameters.set("resonance",12),this.parameters.set("noiseLevel",.3)}trigger(e,c,t){const u=t?.pitch??this.getParameter("pitch",400),T=t?.decay??this.getParameter("decay",.08),m=t?.tone??this.getParameter("tone",.7),x=t?.resonance??this.getParameter("resonance",12),g=t?.noiseLevel??this.getParameter("noiseLevel",.3),d=[],o=this.context.createOscillator(),n=this.context.createBiquadFilter(),a=this.context.createGain();o.type="square",o.frequency.setValueAtTime(u,e),n.type="bandpass",n.frequency.setValueAtTime(u*2,e),n.Q.setValueAtTime(x*m,e),a.gain.setValueAtTime(c*.6,e),this.createEnvelope(a.gain,e,c*.6,.001,T),o.connect(n),n.connect(a),d.push(o,n,a);const h=this.context.createOscillator(),p=this.context.createBiquadFilter(),s=this.context.createGain();h.type="sawtooth",h.frequency.setValueAtTime(u*6,e),h.frequency.exponentialRampToValueAtTime(u*2,e+.01),p.type="highpass",p.frequency.setValueAtTime(2e3,e),p.Q.setValueAtTime(.5,e),s.gain.setValueAtTime(c*g,e),this.createEnvelope(s.gain,e,c*g,.001,.02),h.connect(p),p.connect(s),d.push(h,p,s);const i=this.context.createGain();i.gain.setValueAtTime(.8,e),d.push(i),a.connect(i),s.connect(i),i.connect(this.outputNode),o.start(e),h.start(e);const l=e+T+.05;o.stop(l),h.stop(l);const r={nodes:d,startTime:e,endTime:l,stop:f=>{d.forEach(y=>{if(y instanceof AudioScheduledSourceNode)try{y.stop(f)}catch{}y.disconnect()}),this.voices.delete(r)}};this.voices.add(r),setTimeout(()=>{this.voices.has(r)&&r.stop(this.context.currentTime)},(l-this.context.currentTime)*1e3+100)}}class C extends P{initializeDefaultParameters(){this.parameters.set("pitch",150),this.parameters.set("decay",.4),this.parameters.set("tone",.5),this.parameters.set("pitchDecay",.08),this.parameters.set("pitchAmount",2.5),this.parameters.set("resonance",4)}trigger(e,c,t){const u=t?.pitch??this.getParameter("pitch",150),T=t?.decay??this.getParameter("decay",.4),m=t?.tone??this.getParameter("tone",.5),x=t?.pitchDecay??this.getParameter("pitchDecay",.08),g=t?.pitchAmount??this.getParameter("pitchAmount",2.5),d=t?.resonance??this.getParameter("resonance",4),o=[],n=this.context.createOscillator(),a=this.context.createBiquadFilter(),h=this.context.createGain();n.type="sine";const p=u*g;n.frequency.setValueAtTime(p,e),n.frequency.exponentialRampToValueAtTime(u,e+x),a.type="lowpass",a.frequency.setValueAtTime(u*4,e),a.Q.setValueAtTime(d,e),h.gain.setValueAtTime(c,e),this.createEnvelope(h.gain,e,c,.001,T),n.connect(a),a.connect(h),o.push(n,a,h);const s=this.context.createOscillator(),i=this.context.createBiquadFilter(),l=this.context.createGain();s.type="triangle",s.frequency.setValueAtTime(u*2,e),i.type="highpass",i.frequency.setValueAtTime(200,e),i.Q.setValueAtTime(1,e),l.gain.setValueAtTime(c*m*.4,e),this.createEnvelope(l.gain,e,c*m*.4,.001,.05),s.connect(i),i.connect(l),o.push(s,i,l);const r=this.context.createGain();r.gain.setValueAtTime(.9,e),o.push(r),h.connect(r),l.connect(r),r.connect(this.outputNode),n.start(e),s.start(e);const f=e+T+.1;n.stop(f),s.stop(f);const y={nodes:o,startTime:e,endTime:f,stop:A=>{o.forEach(V=>{if(V instanceof AudioScheduledSourceNode)try{V.stop(A)}catch{}V.disconnect()}),this.voices.delete(y)}};this.voices.add(y),setTimeout(()=>{this.voices.has(y)&&y.stop(this.context.currentTime)},(f-this.context.currentTime)*1e3+100)}}class L extends P{initializeDefaultParameters(){this.parameters.set("pitch",300),this.parameters.set("decay",.12),this.parameters.set("tone",.5),this.parameters.set("harmonics",2.5),this.parameters.set("resonance",6)}trigger(e,c,t){const u=t?.pitch??this.getParameter("pitch",300),T=t?.decay??this.getParameter("decay",.12),m=t?.tone??this.getParameter("tone",.5),x=t?.harmonics??this.getParameter("harmonics",2.5),g=t?.resonance??this.getParameter("resonance",6),d=[],o=this.context.createOscillator(),n=this.context.createOscillator(),a=this.context.createGain();o.type="triangle",o.frequency.setValueAtTime(u,e),o.frequency.exponentialRampToValueAtTime(u*.8,e+T*.3),n.type="sine",n.frequency.setValueAtTime(u*x,e);const h=this.context.createGain(),p=this.context.createGain();h.gain.setValueAtTime(.6,e),p.gain.setValueAtTime(.4*m,e),o.connect(h),n.connect(p),h.connect(a),p.connect(a),d.push(o,n,h,p);const s=this.context.createBiquadFilter();s.type="bandpass",s.frequency.setValueAtTime(u*1.5,e),s.Q.setValueAtTime(g,e),a.connect(s),d.push(s);const i=this.context.createGain();i.gain.setValueAtTime(c*m,e),this.createEnvelope(i.gain,e,c*m,.001,T),s.connect(i),d.push(i,a);const l=this.context.createBuffer(1,this.context.sampleRate*.1,this.context.sampleRate),r=l.getChannelData(0);for(let B=0;B<r.length;B++)r[B]=Math.random()*2-1;const f=this.context.createBufferSource();f.buffer=l;const y=this.context.createBiquadFilter();y.type="highpass",y.frequency.setValueAtTime(u*2,e),y.Q.setValueAtTime(2,e);const A=this.context.createGain();A.gain.setValueAtTime(c*(1-m)*.3,e),this.createEnvelope(A.gain,e,c*(1-m)*.3,.001,T*.5),f.connect(y),y.connect(A),d.push(f,y,A);const V=this.context.createGain();V.gain.setValueAtTime(.7,e),d.push(V),i.connect(V),A.connect(V),V.connect(this.outputNode),o.start(e),n.start(e),f.start(e);const v=e+T+.05;o.stop(v),n.stop(v),f.stop(e+T*.5+.05);const q={nodes:d,startTime:e,endTime:v,stop:B=>{d.forEach(S=>{if(S instanceof AudioScheduledSourceNode)try{S.stop(B)}catch{}S.disconnect()}),this.voices.delete(q)}};this.voices.add(q),setTimeout(()=>{this.voices.has(q)&&q.stop(this.context.currentTime)},(v-this.context.currentTime)*1e3+100)}}export{k as C,F as H,D as K,L as P,E as R,N as S,C as T};
